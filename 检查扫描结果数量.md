# 检查扫描结果数量

## 问题

用户看到扫描结果只有2个，怀疑是否扫描完整。

## 如何确认扫描是否完整

### 1. 查看后端日志（在Ubuntu上）

查看扫描任务的详细日志：

```bash
# 查看最近的扫描日志
docker-compose logs --tail=100 backend | grep -E "\[SAST\]|\[ScannerService\]"

# 或者实时查看
docker-compose logs -f backend | grep -E "\[SAST\]|\[ScannerService\]"
```

应该看到类似这样的日志：
- `[SAST] 开始扫描项目: /app/uploaded_files/project_1`
- `[SAST] Semgrep扫描完成，发现 X 个问题`
- `[ScannerService] 扫描器返回 X 个结果`
- `[ScannerService] 成功保存 X 个扫描结果`

### 2. 检查Semgrep实际扫描结果

在容器内手动执行Semgrep，查看实际扫描结果：

```bash
# 进入后端容器
docker-compose exec backend bash

# 手动执行Semgrep扫描
cd /app/uploaded_files/project_1
semgrep --json --config=auto . | jq '.results | length'

# 或者查看详细信息
semgrep --json --config=auto . > /tmp/semgrep_results.json
cat /tmp/semgrep_results.json | jq '.results | length'
```

### 3. 可能的原因

#### 原因1：Semgrep配置限制
当前使用的 `--config=auto` 可能只检测部分类型的漏洞。可以尝试：

```bash
# 使用更严格的配置
semgrep --json --config=p/security-audit /app/uploaded_files/project_1

# 或者使用所有规则
semgrep --json --config=auto --config=p/security-audit /app/uploaded_files/project_1
```

#### 原因2：项目代码确实比较安全
如果项目使用了安全的编码实践，Semgrep可能确实只发现2个问题。

#### 原因3：某些文件被忽略
Semgrep默认会忽略某些文件（如node_modules、vendor等）。检查是否有重要文件被忽略。

### 4. 改进扫描配置

可以修改 `backend/app/scanners/sast_scanner.py`，使用更严格的扫描规则：

```python
# 当前配置
cmd = ['semgrep', '--json', '--config=auto', project_path]

# 可以改为更严格的配置
cmd = ['semgrep', '--json', '--config=auto', '--config=p/security-audit', project_path]
```

## 下一步

1. **先查看日志**：确认Semgrep实际发现了多少个问题
2. **手动执行Semgrep**：验证扫描结果
3. **如果确实只有2个**：可能需要调整Semgrep配置，使用更严格的规则
4. **如果日志显示更多**：检查是否有保存错误

