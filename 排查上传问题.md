# 排查文件上传问题

## 问题

上传文件后，目录 `/app/uploaded_files/project_1` 不存在。

## 立即排查步骤

### 1. 检查Docker volume和目录

在Ubuntu上执行：

```bash
# 检查基础目录是否存在
docker-compose exec backend ls -la /app/uploaded_files

# 如果目录不存在，创建它
docker-compose exec backend mkdir -p /app/uploaded_files
docker-compose exec backend chmod 777 /app/uploaded_files

# 检查volume挂载
docker-compose exec backend df -h | grep uploaded
```

### 2. 查看后端日志

```bash
# 查看上传相关的日志
docker-compose logs --tail=50 backend | grep -i "upload\|\[Upload\]"

# 实时查看日志
docker-compose logs -f backend
```

### 3. 测试上传API

在浏览器Console中执行：

```javascript
// 测试上传API
const formData = new FormData();
formData.append('file', new File(['test'], 'test.txt'));

const token = localStorage.getItem('token');
fetch('http://192.168.203.141:5000/api/projects/1/upload', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
}).then(r => r.json()).then(console.log).catch(console.error);
```

### 4. 检查后端容器权限

```bash
# 检查容器内用户权限
docker-compose exec backend whoami
docker-compose exec backend ls -la /app
```

## 可能的原因

1. **Docker volume未正确挂载**
   - 检查 `docker-compose.yml` 中的 `uploaded_files` volume配置

2. **目录权限问题**
   - 容器内用户可能没有写入权限

3. **上传请求未到达后端**
   - 检查网络连接和API URL

4. **上传过程中出错**
   - 查看后端日志中的错误信息

## 临时解决方案

如果volume有问题，可以手动创建目录：

```bash
docker-compose exec backend bash -c "mkdir -p /app/uploaded_files && chmod 777 /app/uploaded_files"
```

然后重新尝试上传。

