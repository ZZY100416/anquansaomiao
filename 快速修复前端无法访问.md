# 快速修复前端无法访问问题

## 问题现象

- 容器状态显示 `Up`
- 浏览器显示 `ERR_CONNECTION_REFUSED`
- 无法访问 `192.168.203.141:3000`

## 立即排查（在Ubuntu上执行）

### 步骤1: 查看前端日志（最重要）

```bash
# 查看前端完整日志
docker-compose logs frontend

# 查看最近50行日志
docker-compose logs --tail=50 frontend

# 实时查看日志
docker-compose logs -f frontend
```

**关键检查点**：
- 是否显示 `Compiled successfully!`
- 是否显示 `webpack compiled`
- 是否有错误信息
- 是否显示 `Local: http://localhost:3000`

### 步骤2: 检查前端容器状态

```bash
# 检查容器是否真正运行
docker-compose ps frontend

# 进入前端容器检查
docker-compose exec frontend sh

# 在容器内检查
ps aux | grep node
netstat -tlnp | grep 3000
```

### 步骤3: 检查端口是否监听

```bash
# 在Ubuntu主机上检查端口
sudo netstat -tlnp | grep 3000
# 或者
sudo ss -tlnp | grep 3000

# 从容器内检查
docker-compose exec frontend netstat -tlnp | grep 3000
```

### 步骤4: 测试连接

```bash
# 在Ubuntu主机上测试
curl http://localhost:3000

# 测试IP访问
curl http://192.168.203.141:3000
```

## 常见原因和解决方案

### 原因1: 前端还在编译中（最常见）

**症状**：容器Up，但npm start还在编译

**解决**：
```bash
# 查看日志，等待编译完成
docker-compose logs -f frontend

# 应该看到：
# Compiled successfully!
# webpack compiled with ... warnings
# Local: http://localhost:3000
```

**等待时间**：通常需要1-2分钟首次启动

### 原因2: 前端启动失败

**症状**：日志中有错误信息

**解决**：
```bash
# 查看错误日志
docker-compose logs frontend | grep -i error

# 重启前端
docker-compose restart frontend

# 如果还是失败，重新构建
docker-compose up -d --build frontend
```

### 原因3: 端口映射问题

**症状**：容器内端口正常，但主机无法访问

**解决**：
```bash
# 检查docker-compose.yml中的端口映射
cat docker-compose.yml | grep -A 5 frontend

# 应该看到：
# ports:
#   - "3000:3000"

# 如果不对，修改docker-compose.yml后重启
docker-compose up -d frontend
```

### 原因4: 防火墙阻止

**症状**：容器正常，但外部无法访问

**解决**：
```bash
# 检查防火墙状态
sudo ufw status

# 如果防火墙开启，允许3000端口
sudo ufw allow 3000/tcp

# 或者临时关闭防火墙测试
sudo ufw disable
# 测试后记得重新开启
sudo ufw enable
```

### 原因5: React开发服务器未启动

**症状**：容器运行但npm start未执行

**解决**：
```bash
# 进入容器手动启动
docker-compose exec frontend sh

# 在容器内
cd /app
npm start

# 查看是否有错误
```

## 快速修复命令（一键执行）

```bash
cd ~/projects/anquansaomiao

# 1. 查看前端日志（最重要）
echo "=== 前端日志 ==="
docker-compose logs --tail=30 frontend

# 2. 检查容器状态
echo "=== 容器状态 ==="
docker-compose ps frontend

# 3. 检查端口
echo "=== 端口检查 ==="
sudo netstat -tlnp | grep 3000 || echo "端口未监听"

# 4. 测试本地连接
echo "=== 测试连接 ==="
curl -I http://localhost:3000 2>&1 | head -5

# 5. 如果前端未启动，重启
echo "=== 重启前端 ==="
docker-compose restart frontend

# 6. 等待10秒后再次检查
sleep 10
docker-compose logs --tail=10 frontend
```

## 验证步骤

1. **查看日志**：`docker-compose logs -f frontend`
   - 应该看到 `Compiled successfully!`
   - 应该看到 `Local: http://localhost:3000`

2. **测试端口**：`curl http://localhost:3000`
   - 应该返回HTML内容，不是连接拒绝

3. **浏览器访问**：`http://192.168.203.141:3000`
   - 应该看到登录页面

## 如果还是不行

### 完全重建前端

```bash
# 停止前端
docker-compose stop frontend

# 删除前端容器
docker rm -f uss-frontend

# 重新构建并启动
docker-compose up -d --build frontend

# 查看日志
docker-compose logs -f frontend
```

### 检查网络配置

```bash
# 检查Docker网络
docker network ls | grep scanner

# 检查容器网络
docker inspect uss-frontend | grep -A 20 NetworkSettings
```

