# Docker构建错误修复指南

## 问题描述

构建Docker镜像时出现错误：
```
apt-key: not found
```

## 原因

新版本的Debian/Ubuntu系统已经移除了`apt-key`命令，需要使用新的GPG密钥管理方式。

## 已修复

已更新`backend/Dockerfile`，使用新的方法：

1. 使用`/usr/share/keyrings/`目录存储GPG密钥
2. 在sources.list中使用`signed-by`参数

## 重新构建

修复后，在Ubuntu上执行：

```bash
# 进入项目目录
cd ~/projects/anquansaomiao

# 清理之前的构建缓存（可选）
docker-compose down
docker system prune -f

# 重新构建并启动
docker-compose up -d --build
```

## 如果还有问题

### 问题1: lsb-release未找到

如果仍然报错，可能需要先安装`lsb-release`（已在Dockerfile中修复）。

### 问题2: 网络问题

如果下载Trivy或Dependency-Check失败：

```bash
# 可以暂时注释掉Trivy安装，先让服务启动
# 或者使用代理
```

### 问题3: 构建时间过长

构建过程可能需要较长时间（下载依赖、构建镜像），请耐心等待。

## 验证修复

构建成功后：

```bash
# 检查服务状态
docker-compose ps

# 查看日志
docker-compose logs backend
```

