# 统一安全扫描平台测试报告

> 本报告覆盖统一安全扫描平台（USS）V1.0 在 Ubuntu 22.04 环境下的功能、接口、安全及集成测试结果，包括 RASP 攻击场景验证。测试时间：2025-11-07，测试人员：Security Team。

## 1. 测试概览

| 项目 | 说明 |
| ---- | ---- |
| 测试环境 | Ubuntu 22.04、Docker 24、Docker Compose v2、PostgreSQL 15、Node 18、Python 3.11、OpenJDK 21 |
| 服务部署 | `docker-compose up -d --build`，前端端口 3000、后端 5000 |
| 被测项目 | `chatbotAi`（Spring Boot + MySQL）|
| RASP 配置 | 手工集成 OpenRASP，app_id `0c91b98f2aa79983228f10fc37725da726bd31d6` |

## 2. 测试范围

1. 功能测试：项目管理、代码上传、扫描任务（SAST/SCA/容器/RASP）、报告导出、仪表盘。
2. 接口测试：`/api/projects`、`/api/scans`、`/api/rasp/events`、认证相关接口。
3. 安全测试：权限校验、Token 过期、RASP 攻击拦截。
4. 运维场景：MySQL 连接修复、OpenRASP YAML 配置、Dependency-Check 下载故障。

## 3. 功能用例执行

| 用例编号 | 描述 | 步骤 | 期望结果 | 实际结果 |
| -------- | ---- | ---- | -------- | -------- |
| TC-FUN-01 | 创建项目 | 登录 → 新建项目 → 填写信息 | 项目创建成功 | 通过 |
| TC-FUN-02 | 上传源码 | 项目详情 → 上传 ZIP | 文件状态显示“已上传”，服务器存在目录 | 通过 |
| TC-FUN-03 | 发起 SAST | 创建 SAST 任务 | 状态变为完成，结果列表出现高/中/低风险 | 通过（Semgrep 返回 2 条示例风险） |
| TC-FUN-04 | 发起 SCA | 创建 SCA 任务 | 返回依赖漏洞（若无则显示 0） | 通过（Dependency-Check 缺失时返回 Mock 提示） |
| TC-FUN-05 | 容器扫描 | 填写 `{"image_name":"mysql:8"}` | Trivy 输出 CVE 列表 | 通过 |
| TC-FUN-06 | RASP 事件 | 触发模拟攻击 | 后台出现事件记录 | 通过（拦截 Path Traversal） |
| TC-FUN-07 | 报告导出 | 在任务详情点击导出 | 生成 JSON 文件 | 通过 |
| TC-FUN-08 | 仪表盘统计 | 进入仪表盘 | 显示项目数、漏洞数 | 通过 |

## 4. 接口测试

### 4.1 `/api/projects`

- **方法**：`GET/POST`
- **验证点**：JWT 校验、分页、字段完整性
- **结果**：全部 200；越权访问（无 Token）返回 401

### 4.2 `/api/scans`

- **方法**：`POST`
- **验证点**：任务入队、必填字段校验
- **结果**：无参数时返回 400；正确参数返回 201
\n+### 4.3 `/api/rasp/events`

- **方法**：`GET`
- **验证点**：自动登录 OpenRASP、返回格式
- **结果**：首次请求自动获取 Cookie，后续返回包含 `attack_type`、`intercept_state`

## 5. 安全与异常测试

| 编号 | 场景 | 操作 | 预期 | 结果 |
| ---- | ---- | ---- | ---- | ---- |
| TC-SEC-01 | Token 过期 | 手动删除 localStorage token | 接口返回 401 | 通过 |
| TC-SEC-02 | 越权访问 | 使用普通用户访问其他项目 | 被拒绝 403 | 通过 |
| TC-SEC-03 | Path Traversal | 请求 `/api/chat-history/test-rasp-file?filename=/etc/passwd` | RASP 拦截并记录日志 | 通过（后台显示拦截请求） |
| TC-SEC-04 | SQL 注入 | 构造 `OR '1'='1'` | 输入未使用在 SQL（ORM） | 通过 |

## 6. 运维验证

| 事项 | 操作 | 结果 |
| ---- | ---- | ---- |
| Dependency-Check 故障恢复 | Dockerfile 重试 + 手工下载 | 成功；详见 `手动安装Dependency-Check.md` |
| MySQL 权限修复 | 执行 `DROP/CREATE USER` 脚本 | Spring Boot 重启后连接成功 |
| OpenRASP YAML 格式修复 | 使用脚本自动处理缩进 | 解析错误消失 |

## 7. 结果结论
\n+- 功能用例全部通过；SCA 在工具缺失时提供 Mock 提示，需要运维关注。
- 安全用例通过，RASP 能捕获并记录攻击事件。
- 主要风险：
  1. 报告格式较简陋，需后续增强。
  2. RASP 日志默认未生成，需要在 YAML 中手动配置。

## 8. 改进建议

1. 增加 PDF/HTML 报告导出、支持定期邮件推送。
2. 在平台中集成 OpenRASP 日志路径配置开关。
3. 扩展 SCA 规则库更新策略，加入自动同步。
4. 引入消息通知（Webhook/IM）缩短响应时间。


