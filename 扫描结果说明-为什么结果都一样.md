# 扫描结果说明 - 为什么不同项目的结果都一样？

## 问题原因

从代码分析发现，**扫描确实执行了**，但返回的是**模拟数据**，原因如下：

### 1. SAST扫描（静态代码扫描）

**问题**：项目文件不存在
- 扫描器会检查路径：`/app/uploaded_files/project_{project_id}`
- 如果路径不存在，返回固定的模拟数据
- **结果**：所有没有上传项目文件的项目，都会得到相同的模拟结果

**真实扫描需要**：
- 上传项目代码到 `/app/uploaded_files/project_{project_id}` 目录
- 或者配置项目的实际代码路径

### 2. SCA扫描（依赖漏洞扫描）

**问题**：项目文件不存在
- 同样检查路径：`/app/uploaded_files/project_{project_id}`
- 如果路径不存在，返回固定的模拟数据
- **结果**：所有没有上传项目文件的项目，都会得到相同的模拟结果

**真实扫描需要**：
- 上传项目代码（包含 `package.json`, `requirements.txt`, `pom.xml` 等依赖文件）
- 到 `/app/uploaded_files/project_{project_id}` 目录

### 3. 容器扫描

**问题**：未配置镜像名称
- 如果扫描配置中没有 `image_name`，返回模拟数据
- **结果**：所有没有配置镜像名称的扫描，都会得到相同的模拟结果

**真实扫描需要**：
- 在扫描配置中填写：`{"image_name": "nginx:latest"}`
- 确保镜像可以拉取（Docker需要能访问该镜像）

### 4. RASP扫描

**问题**：OpenRASP未连接或未配置app_id
- 如果OpenRASP服务未运行（localhost:11111），返回模拟数据
- 如果未配置 `app_id`，也会返回模拟数据

**真实扫描需要**：
- 启动OpenRASP服务
- 在扫描配置中填写：`{"app_id": "your-app-id"}`

## 如何区分模拟数据和真实扫描结果

### 方法1：查看扫描结果详情

点击"查看结果"按钮，查看结果详情：
- **模拟数据**：标题会包含"（模拟数据）"，描述会说明原因
- **真实扫描**：结果来自实际扫描工具（Semgrep、Trivy等）

### 方法2：查看后端日志

在Ubuntu上查看后端日志：
```bash
docker-compose logs backend | grep -i "警告\|模拟\|mock"
```

会看到类似日志：
```
[SAST] 警告: 项目路径不存在 /app/uploaded_files/project_1，返回模拟数据
[SCA] 警告: 项目路径不存在 /app/uploaded_files/project_2，返回模拟数据
[Container] 警告: 未配置镜像名称，返回模拟数据
```

### 方法3：检查扫描结果中的raw_data

在扫描结果详情中，查看"原始数据"：
- **模拟数据**：`raw_data` 中会包含 `"is_mock": true` 和 `"reason"` 字段
- **真实扫描**：`raw_data` 包含扫描工具返回的原始数据

## 解决方案

### 方案1：上传项目文件（推荐）

要让SAST和SCA扫描真实执行，需要上传项目文件：

1. **在服务器上创建项目目录**：
```bash
# 在Ubuntu上
docker-compose exec backend mkdir -p /app/uploaded_files/project_1
docker-compose exec backend mkdir -p /app/uploaded_files/project_2
```

2. **上传项目代码**：
```bash
# 使用docker cp命令
docker cp /path/to/your/project/. uss-backend:/app/uploaded_files/project_1/
```

3. **或者通过前端上传**（需要实现文件上传功能）

### 方案2：配置真实的扫描参数

**容器扫描**：
- 在扫描配置中填写真实的镜像名称：
```json
{"image_name": "nginx:latest"}
```

**RASP扫描**：
- 启动OpenRASP服务
- 在扫描配置中填写应用ID：
```json
{"app_id": "your-app-id"}
```

## 已实施的改进

1. ✅ **添加警告日志**：扫描器会在日志中明确标记模拟数据
2. ✅ **改进结果描述**：模拟数据的结果描述中会说明原因
3. ✅ **标记原始数据**：在 `raw_data` 中添加 `is_mock` 标记

## 下一步

1. **查看扫描结果详情**：点击"查看结果"按钮，查看是否为模拟数据
2. **查看后端日志**：确认扫描器是否检测到项目文件
3. **上传项目文件**：如果需要真实扫描，上传项目代码
4. **配置扫描参数**：容器扫描需要配置镜像名称

现在扫描结果会明确标注是否为模拟数据，方便区分！

